<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>SNSF Research Network</title>

<script src="index_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.6/css/bootstrap.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.6/js/bootstrap.min.js"></script>
<script src="index_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>
<link href="index_files/magnific-popup-1.1.0/magnific-popup.css" rel="stylesheet" />
<script src="index_files/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script>
<link href="index_files/clean-0.1/clean.css" rel="stylesheet" />
<script src="index_files/clean-0.1/clean.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
<div class="container-fluid main-container">
  <div class="row">
     <div class="col-md-10">



<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="text-muted">Code</span> <span class="text-muted caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All</a></li>
</ul>
</div>

<div id="header">
<h1 class="title">SNSF Research Network</h1>
</div>

<div id="content">
<blockquote>
<p>Mapping Collaborations in Research Projects Funded by the SNSF in 2017.</p>
</blockquote>
<div id="data" class="section level2">
<h2>Data</h2>
<p>SNSF grant data is <a href="http://p3.snf.ch/Pages/DataAndDocumentation.aspx">here</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># grants &lt;- rio::import(&quot;http://p3.snf.ch/P3Export/P3_GrantExport.csv&quot;) %&gt;% </span>
<span class="co">#   janitor::clean_names() %&gt;%</span>
grants &lt;-<span class="st"> </span><span class="kw">read_rds</span>(<span class="st">&quot;grants.rds.bz2&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(project_number, start_date, end_date) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">start_date =</span> <span class="kw">dmy</span>(start_date), <span class="dt">end_date =</span> <span class="kw">dmy</span>(end_date)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(end_date <span class="op">&gt;=</span><span class="st"> </span>TIME_WINDOW[<span class="dv">1</span>], start_date <span class="op">&lt;=</span><span class="st"> </span>TIME_WINDOW[<span class="dv">2</span>])

<span class="co"># people &lt;- rio::import(&quot;http://p3.snf.ch/P3Export/P3_PersonExport.csv&quot;) %&gt;%</span>
<span class="co">#   janitor::clean_names() %&gt;%</span>

people &lt;-<span class="st"> </span><span class="kw">read_rds</span>(<span class="st">&quot;ppl.rds.bz2&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(
    person_id_snsf, 
    institute_place,
    projects_as_responsible_applicant,
    projects_as_applicant, 
    projects_as_partner,
    projects_as_practice_partner,
    projects_as_employee) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># for consistency</span>
<span class="st">  </span><span class="kw">unite</span>(project_number, <span class="kw">starts_with</span>(<span class="st">&quot;projects&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># remove missing affiliations</span>
<span class="st">  </span><span class="kw">filter</span>(institute_place <span class="op">!=</span><span class="st"> &quot;&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">institute_place =</span> <span class="kw">str_replace_all</span>(
      institute_place,
      <span class="st">&quot;^[A-Z]{2}[ ]| [(](.*)[)]| Cedex(.*)?| [0-9]{1,2}&quot;</span>, <span class="st">&quot;&quot;</span>),
    <span class="co"># unite() includes NAs...</span>
    <span class="dt">project_number =</span> <span class="kw">str_replace_all</span>(project_number, <span class="st">&quot;NA&quot;</span>, <span class="st">&quot;&quot;</span>),
    <span class="dt">project_number =</span> <span class="kw">str_replace_all</span>(project_number, <span class="st">&quot;[;]+&quot;</span>, <span class="st">&quot;;&quot;</span>),
    <span class="dt">project_number =</span> <span class="kw">str_replace_all</span>(project_number, <span class="st">&quot;^[;]|[;]$&quot;</span>, <span class="st">&quot;&quot;</span>),
    <span class="co"># to unnest</span>
    <span class="dt">project_number =</span> <span class="kw">str_split</span>(project_number, <span class="st">&quot;;&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># for consistency with grants</span>
<span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(grants, <span class="dt">by =</span> <span class="st">&quot;project_number&quot;</span>)

<span class="co"># wrapper function to count the number</span>
<span class="co"># of distinct *institute_place* per *project_number*</span>
loc_count &lt;-<span class="st"> </span><span class="cf">function</span>(dat) {
  <span class="kw">group_by</span>(dat, project_number) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">n_loc =</span> <span class="kw">n_distinct</span>(institute_place))
}

<span class="co"># network core: grants involving multiple places</span>
core &lt;-<span class="st"> </span>people <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>person_id_snsf) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(<span class="kw">filter</span>(<span class="kw">loc_count</span>(people), n_loc <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>), <span class="dt">by =</span> <span class="st">&quot;project_number&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(project_number)

<span class="kw">head</span>(core)</code></pre></div>
<pre><code>##   institute_place project_number
## 1        Konstanz         128565
## 2            Bern         128565
## 3          Berlin         129572
## 4           Basel         129572
## 5          ZÃ¼rich         135192
## 6      St. Gallen         135192</code></pre>
<p>We need geocodes for all the places listed in the dataset. Information on how to get geocode data in <code>R</code> is given <a href="https://gis.stackexchange.com/questions/158328/batch-geocoding-in-r">here</a> and <a href="https://github.com/hrbrmstr/nominatim">here</a>. In essence, I use the <code>google maps</code> API as a fallback of the <code>openstreetmaps</code> API. To save the effort of writing html requests, I use dedicated <code>R</code> packages to query map data. And to speed up the analysis, I store the geocodes in <code>geocodes.csv</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># initialize geocodes as a tibble</span>
geocodes &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">place =</span> <span class="kw">sort</span>(<span class="kw">unique</span>(core<span class="op">$</span>institute_place)),
  <span class="dt">lat =</span> <span class="kw">rep</span>(<span class="ot">NA_real_</span>, <span class="kw">n_distinct</span>(core<span class="op">$</span>institute_place)),
  <span class="dt">lon =</span> <span class="kw">rep</span>(<span class="ot">NA_real_</span>, <span class="kw">n_distinct</span>(core<span class="op">$</span>institute_place)),
  <span class="dt">addr =</span> <span class="kw">rep</span>(<span class="ot">NA_character_</span>, <span class="kw">n_distinct</span>(core<span class="op">$</span>institute_place)),
  <span class="dt">id =</span> <span class="kw">rep</span>(<span class="ot">NA_character_</span>, <span class="kw">n_distinct</span>(core<span class="op">$</span>institute_place)))

<span class="kw">p_load_gh</span>(<span class="st">&quot;hrbrmstr/nominatim&quot;</span>, <span class="st">&quot;ggmap&quot;</span>) <span class="co"># ggmap needs `libpng16-dev` (on linux)</span>
osm_key &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;mapquest.key&quot;</span>)

<span class="co"># openstreetmap api</span>
osm &lt;-<span class="st"> </span><span class="cf">function</span>(query, osm_key) {
  r &lt;-<span class="st"> </span><span class="kw">osm_search_spatial</span>(query, <span class="dt">limit =</span> <span class="dv">1</span>, <span class="dt">key =</span> osm_key)
  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(r[[<span class="dv">1</span>]])) {
    <span class="kw">c</span>(r[[<span class="dv">1</span>]]<span class="op">$</span>place_id, r[[<span class="dv">1</span>]]<span class="op">$</span>display_name, r[[<span class="dv">1</span>]]<span class="op">$</span>lat, r[[<span class="dv">1</span>]]<span class="op">$</span>lon)
  } <span class="cf">else</span> <span class="kw">return</span>(<span class="ot">NA</span>)
}

<span class="co"># googlemaps api (2500 reqs/day, 50 reqs/sec max)</span>
google &lt;-<span class="st"> </span><span class="cf">function</span>(query) {
  r &lt;-<span class="st"> </span><span class="kw">geocode</span>(query, <span class="dt">output =</span> <span class="st">&quot;all&quot;</span>)
  <span class="cf">if</span> (r<span class="op">$</span>status <span class="op">==</span><span class="st"> &quot;OK&quot;</span>) {
    <span class="kw">c</span>(r<span class="op">$</span>results[[<span class="dv">1</span>]]<span class="op">$</span>place_id, r<span class="op">$</span>results[[<span class="dv">1</span>]]<span class="op">$</span>formatted_address,
      r<span class="op">$</span>results[[<span class="dv">1</span>]]<span class="op">$</span>geometry<span class="op">$</span>location<span class="op">$</span>lat, r<span class="op">$</span>results[[<span class="dv">1</span>]]<span class="op">$</span>geometry<span class="op">$</span>location<span class="op">$</span>lng)
  } <span class="cf">else</span> <span class="kw">return</span>(<span class="ot">NA</span>)
}

<span class="cf">for</span> (k <span class="cf">in</span> <span class="kw">seq_along</span>(geocodes<span class="op">$</span>place)) {
  <span class="kw">cat</span>(<span class="st">&quot;   ........ &quot;</span>, k, <span class="st">&quot;: &quot;</span>, geocodes<span class="op">$</span>place[k], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
  info &lt;-<span class="st"> </span><span class="kw">osm</span>(<span class="kw">iconv</span>(geocodes<span class="op">$</span>place[k], <span class="dt">to=</span><span class="st">&quot;ASCII//TRANSLIT&quot;</span>), osm_key)
  <span class="kw">cat</span>(<span class="st">&quot;   osm info: &quot;</span>, info, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
  <span class="co"># fallback</span>
  <span class="cf">if</span> (<span class="kw">is.na</span>(info)) {
    info &lt;-<span class="st"> </span><span class="kw">google</span>(geocodes<span class="op">$</span>place[k])
    <span class="kw">cat</span>(<span class="st">&quot;    google: &quot;</span>, info, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
  }
  <span class="co"># store info in meta</span>
  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.na</span>(info)) {
    geocodes<span class="op">$</span>id[k] =<span class="st"> </span>info[<span class="dv">1</span>]
    geocodes<span class="op">$</span>addr[k] =<span class="st"> </span>info[<span class="dv">2</span>]
    geocodes<span class="op">$</span>lat[k] =<span class="st"> </span><span class="kw">as.numeric</span>(info[<span class="dv">3</span>])
    geocodes<span class="op">$</span>lon[k] =<span class="st"> </span><span class="kw">as.numeric</span>(info[<span class="dv">4</span>])
  }
}
<span class="co"># it works despite of some warnings...</span>
rio<span class="op">::</span><span class="kw">export</span>(geocodes, <span class="st">&quot;geocodes.csv&quot;</span>)</code></pre></div>
</div>
<div id="collaborations-within-switzerland" class="section level2">
<h2>Collaborations within Switzerland</h2>
<p>Credits: <a href="http://kateto.net/network-visualization">kateto.net</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">geocodes &lt;-<span class="st"> </span>rio<span class="op">::</span><span class="kw">import</span>(<span class="st">&quot;geocodes.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>()

core &lt;-<span class="st"> </span>core <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(geocodes, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;institute_place&quot;</span> =<span class="st"> &quot;place&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">country =</span> <span class="kw">map_chr</span>(<span class="kw">strsplit</span>(addr, <span class="st">&quot;, &quot;</span>), tail, <span class="dt">n =</span> <span class="dv">1</span>),
    <span class="co"># unify names between google maps and openstreetmaps</span>
    <span class="dt">country =</span> <span class="kw">str_replace_all</span>(country, <span class="st">&quot;^United Kingdom$&quot;</span>, <span class="st">&quot;UK&quot;</span>),
    <span class="dt">country =</span> <span class="kw">str_replace_all</span>(country, <span class="st">&quot;^Russian Federation$&quot;</span>, <span class="st">&quot;Russia&quot;</span>),
    <span class="dt">country =</span> <span class="kw">str_replace_all</span>(country, <span class="st">&quot;^United States of America$&quot;</span>, <span class="st">&quot;USA&quot;</span>),
    <span class="dt">country =</span> <span class="kw">str_replace_all</span>(country, <span class="st">&quot;^The Netherlands$&quot;</span>, <span class="st">&quot;Netherlands&quot;</span>))

<span class="co"># build graph elements ----------------------------------------------------</span>

make_nodes &lt;-<span class="st"> </span><span class="cf">function</span>(df_core) {
  <span class="kw">group_by</span>(df_core, institute_place) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">x =</span> <span class="kw">head</span>(lon, <span class="dv">1</span>), <span class="dt">y =</span> <span class="kw">head</span>(lat, <span class="dv">1</span>), <span class="dt">size =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(size))
}

make_edges &lt;-<span class="st"> </span><span class="cf">function</span>(df_core) {
  triangulation &lt;-<span class="st"> </span><span class="cf">function</span>(proj_no, df) {
    links &lt;-<span class="st"> </span><span class="kw">filter</span>(df, project_number <span class="op">==</span><span class="st"> </span>proj_no) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">select</span>(institute_place) <span class="op">%$%</span>
<span class="st">      </span><span class="kw">combn</span>(<span class="kw">sort</span>(institute_place), <span class="dt">m =</span> <span class="dv">2</span>)
    <span class="kw">data.frame</span>(
    <span class="dt">number =</span> <span class="kw">rep</span>(proj_no, <span class="kw">ncol</span>(links)),
    <span class="dt">from =</span> links[<span class="dv">1</span>, ],
    <span class="dt">to =</span> links[<span class="dv">2</span>,],
    <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
  }
  unique_numbers &lt;-<span class="st"> </span><span class="kw">unique</span>(df_core<span class="op">$</span>project_number)
  edges_ch &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(unique_numbers, triangulation, <span class="dt">df =</span> df_core)
  <span class="kw">do.call</span>(bind_rows, edges_ch)
}

<span class="co"># Switzerland -------------------------------------------------------------</span>

core_ch &lt;-<span class="st"> </span><span class="kw">filter</span>(core, country <span class="op">==</span><span class="st"> &quot;Switzerland&quot;</span>)
<span class="co"># swiss core: projects involving multiple places in Switzerland</span>
core_ch &lt;-<span class="st"> </span>core_ch <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(<span class="kw">filter</span>(<span class="kw">loc_count</span>(core_ch), n_loc <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>), <span class="dt">by =</span> <span class="st">&quot;project_number&quot;</span>)

<span class="co"># nodes (places) ----------------------------------------------------------</span>
nodes_ch &lt;-<span class="st"> </span><span class="kw">make_nodes</span>(core_ch)
<span class="co"># edges (grants) ----------------------------------------------------------</span>
edges_ch &lt;-<span class="st"> </span><span class="kw">make_edges</span>(core_ch)

<span class="co"># add geocode metadata and group</span>
edges_ch &lt;-<span class="st"> </span>edges_ch <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(nodes_ch, <span class="op">-</span>size), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;from&quot;</span> =<span class="st"> &quot;institute_place&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">x1 =</span> x, <span class="dt">y1 =</span> y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(nodes_ch, <span class="op">-</span>size), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;to&quot;</span> =<span class="st"> &quot;institute_place&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">x2 =</span> x, <span class="dt">y2 =</span> y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(from, to) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">x1 =</span> <span class="kw">head</span>(x1, <span class="dv">1</span>), <span class="dt">y1 =</span> <span class="kw">head</span>(y1, <span class="dv">1</span>),
    <span class="dt">x2 =</span> <span class="kw">head</span>(x2, <span class="dv">1</span>), <span class="dt">y2 =</span> <span class="kw">head</span>(y2, <span class="dv">1</span>),
    <span class="dt">strength =</span> <span class="kw">n</span>())

<span class="co"># mapping -----------------------------------------------------------------</span>

<span class="kw">p_load</span>(<span class="st">&quot;maps&quot;</span>, <span class="st">&quot;mapdata&quot;</span>, <span class="st">&quot;geosphere&quot;</span>)

<span class="co"># color ramp</span>
make_ramp &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">alpha1 =</span> .<span class="dv">45</span>, <span class="dt">alpha2 =</span> .<span class="dv">2</span>, 
                      <span class="dt">col1 =</span> <span class="st">&quot;#003399&quot;</span>, <span class="dt">col2 =</span> <span class="st">&quot;#252525&quot;</span>, 
                      <span class="dt">n_shades =</span> <span class="dv">100</span>) {
  col1 =<span class="st"> </span><span class="kw">adjustcolor</span>(col1, <span class="dt">alpha.f =</span> alpha1)
  col2 =<span class="st"> </span><span class="kw">adjustcolor</span>(col2, <span class="dt">alpha.f =</span> alpha2)
  <span class="kw">colorRampPalette</span>(<span class="kw">c</span>(col2, col1), <span class="dt">alpha =</span> <span class="ot">TRUE</span>)(n_shades)
}
<span class="co"># map nodes</span>
add_nodes &lt;-<span class="st"> </span><span class="cf">function</span>(nodes, ramp, <span class="dt">cex_scale =</span> <span class="dv">3</span>) {
  <span class="kw">with</span>(nodes, {
    <span class="co"># scale node size</span>
    s &lt;-<span class="st"> </span>size <span class="op">/</span><span class="st">  </span><span class="kw">max</span>(size)
    <span class="kw">points</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, 
           <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> cex_scale <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(s), <span class="dt">col =</span> ramp[<span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>s)])
  })
}
<span class="co"># map edges</span>
add_edges &lt;-<span class="st"> </span><span class="cf">function</span>(edges, ramp, <span class="dt">lwd_scale =</span> <span class="dv">4</span>) {
  <span class="kw">with</span>(edges, {
    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(edges))  {
      arc &lt;-<span class="st"> </span><span class="kw">gcIntermediate</span>(<span class="kw">c</span>(x1[k], y1[k]), <span class="kw">c</span>(x2[k], y2[k]), <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">addStartEnd =</span> <span class="ot">TRUE</span>)
      s &lt;-<span class="st"> </span>strength[k] <span class="op">/</span><span class="st"> </span><span class="kw">max</span>(strength)
      <span class="kw">lines</span>(arc, <span class="dt">col =</span> ramp[<span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>s)], <span class="dt">lwd =</span> lwd_scale <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(s))
    }
  })
}

<span class="kw">svg</span>(<span class="st">&quot;map_ch.svg&quot;</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))
maps<span class="op">::</span><span class="kw">map</span>(<span class="dt">database =</span> <span class="st">&quot;worldHires&quot;</span>, <span class="dt">regions =</span> <span class="st">&quot;Switzerland&quot;</span>, <span class="dt">fill =</span> <span class="ot">FALSE</span>, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, .<span class="dv">3</span>))
edge_col &lt;-<span class="st"> </span><span class="kw">make_ramp</span>()
<span class="kw">add_nodes</span>(nodes_ch, <span class="dt">ramp =</span> edge_col)
<span class="kw">add_edges</span>(edges_ch, <span class="dt">ramp =</span> edge_col)

<span class="co"># label university cities</span>
uni &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ZÃ¼rich&quot;, &quot;</span>Lausanne<span class="st">&quot;, &quot;</span>Bern<span class="st">&quot;, &quot;</span>GenÃ¨ve<span class="st">&quot;,&quot;</span>Basel<span class="st">&quot;, &quot;</span>Fribourg<span class="st">&quot;, &quot;</span>NeuchÃ¢tel<span class="st">&quot;, &quot;</span>St. Gallen<span class="st">&quot;, &quot;</span>Lugano<span class="st">&quot;, &quot;</span>Luzern<span class="st">&quot;)</span>
<span class="st">uni_nodes &lt;- filter(nodes_ch, institute_place %in% uni)</span>
<span class="st">with(uni_nodes, {</span>
<span class="st">  text(x, y, institute_place, </span>
<span class="st">    pos = 3, cex = .7, col = rgb(0, 0, 0, .66))</span>
<span class="st">})</span>
<span class="st">invisible(dev.off())</span></code></pre></div>
</div>
<div id="collaborations-within-europe" class="section level2">
<h2>Collaborations within Europe</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">close_countries &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="st">&quot;Switzerland&quot;</span>, <span class="st">&quot;Austria&quot;</span>, <span class="st">&quot;Belgium&quot;</span>, <span class="st">&quot;Bulgaria&quot;</span>, <span class="st">&quot;Croatia&quot;</span>,
  <span class="st">&quot;Cyprus&quot;</span>, <span class="st">&quot;Czech Republic&quot;</span>, <span class="st">&quot;Denmark&quot;</span>, <span class="st">&quot;Estonia&quot;</span>, <span class="st">&quot;Finland&quot;</span>, <span class="st">&quot;France&quot;</span>,
  <span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;Greece&quot;</span>, <span class="st">&quot;Hungary&quot;</span>, <span class="st">&quot;Ireland&quot;</span>, <span class="st">&quot;Italy&quot;</span>, <span class="st">&quot;Latvia&quot;</span>, 
  <span class="st">&quot;Lithuania&quot;</span>, <span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Malta&quot;</span>, <span class="st">&quot;Netherlands&quot;</span>, <span class="st">&quot;Poland&quot;</span>, <span class="st">&quot;Portugal&quot;</span>,
  <span class="st">&quot;Romania&quot;</span>, <span class="st">&quot;Slovakia&quot;</span>, <span class="st">&quot;Slovenia&quot;</span>, <span class="st">&quot;Spain&quot;</span>, <span class="st">&quot;Sweden&quot;</span>, <span class="st">&quot;UK&quot;</span>,
  <span class="st">&quot;Serbia&quot;</span>, <span class="st">&quot;Bosnia and Herzegovina&quot;</span>, <span class="st">&quot;Moldova&quot;</span>, <span class="st">&quot;Norway&quot;</span>,
  <span class="st">&quot;Georgia&quot;</span>, <span class="st">&quot;Turkey&quot;</span>, <span class="st">&quot;Armenia&quot;</span>, <span class="st">&quot;Ukraine&quot;</span>, <span class="st">&quot;Iceland&quot;</span>, <span class="st">&quot;Montenegro&quot;</span>,
  <span class="st">&quot;Albania&quot;</span>, <span class="st">&quot;Macedonia&quot;</span>, <span class="st">&quot;Lichtenstein&quot;</span>, <span class="st">&quot;Andorra&quot;</span>)
not_mapped &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Israel&quot;</span>, <span class="st">&quot;Morocco&quot;</span>, <span class="st">&quot;Algeria&quot;</span>, <span class="st">&quot;Tunisia&quot;</span>, <span class="st">&quot;Libya&quot;</span>, 
                <span class="st">&quot;Egypt&quot;</span>, <span class="st">&quot;Jordan&quot;</span>, <span class="st">&quot;Lebanon&quot;</span>, <span class="st">&quot;Syria&quot;</span>, <span class="st">&quot;Russia&quot;</span>)

core_eu &lt;-<span class="st"> </span><span class="kw">filter</span>(core, country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(close_countries, not_mapped))
core_eu &lt;-<span class="st"> </span>core_eu <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(<span class="kw">filter</span>(<span class="kw">loc_count</span>(core_eu), n_loc <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>), <span class="dt">by =</span> <span class="st">&quot;project_number&quot;</span>)

nodes_eu &lt;-<span class="st"> </span><span class="kw">make_nodes</span>(core_eu)
edges_eu &lt;-<span class="st"> </span><span class="kw">make_edges</span>(core_eu)

<span class="co"># add geocode metadata and group</span>
edges_eu &lt;-<span class="st"> </span>edges_eu <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(nodes_eu, <span class="op">-</span>size), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;from&quot;</span> =<span class="st"> &quot;institute_place&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">x1 =</span> x, <span class="dt">y1 =</span> y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(nodes_eu, <span class="op">-</span>size), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;to&quot;</span> =<span class="st"> &quot;institute_place&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">x2 =</span> x, <span class="dt">y2 =</span> y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(from, to) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">x1 =</span> <span class="kw">head</span>(x1, <span class="dv">1</span>), <span class="dt">y1 =</span> <span class="kw">head</span>(y1, <span class="dv">1</span>),
    <span class="dt">x2 =</span> <span class="kw">head</span>(x2, <span class="dv">1</span>), <span class="dt">y2 =</span> <span class="kw">head</span>(y2, <span class="dv">1</span>),
    <span class="dt">strength =</span> <span class="kw">n</span>())

nodes_eu &lt;-<span class="st"> </span><span class="kw">anti_join</span>(nodes_eu, nodes_ch, <span class="dt">by =</span> <span class="st">&quot;institute_place&quot;</span>)
edges_eu &lt;-<span class="st"> </span>edges_eu <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(edges_ch, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;from&quot;</span> =<span class="st"> &quot;from&quot;</span>, <span class="st">&quot;to&quot;</span> =<span class="st"> &quot;to&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">drop_na</span>()

<span class="kw">svg</span>(<span class="st">&quot;map_eu.svg&quot;</span>, <span class="dt">width =</span> <span class="dv">12</span>, <span class="dt">height =</span> <span class="dv">7</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))
<span class="co"># maps::map(database = &quot;worldHires&quot;, </span>
maps<span class="op">::</span><span class="kw">map</span>(<span class="dt">regions =</span> <span class="kw">str_c</span>(close_countries, <span class="dt">collapse =</span> <span class="st">&quot;|&quot;</span>), 
          <span class="dt">fill =</span> <span class="ot">FALSE</span>, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, .<span class="dv">2</span>), 
          <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">25</span>, <span class="dv">50</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">70</span>))
edge_col &lt;-<span class="st"> </span><span class="kw">make_ramp</span>(<span class="fl">0.5</span>, <span class="fl">0.1</span>)
<span class="kw">add_nodes</span>(nodes_eu, <span class="dt">ramp =</span> edge_col, <span class="dt">cex_scale =</span> <span class="fl">1.2</span>)
<span class="kw">add_edges</span>(edges_eu, <span class="dt">ramp =</span> edge_col, <span class="dt">lwd_scale =</span> <span class="fl">1.2</span>)
<span class="kw">invisible</span>(<span class="kw">dev.off</span>())</code></pre></div>
</div>
<div id="collaborations-with-the-rest-of-the-world" class="section level2">
<h2>Collaborations with the rest of the world</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nodes_io &lt;-<span class="st"> </span><span class="kw">make_nodes</span>(core)
edges_io &lt;-<span class="st"> </span><span class="kw">make_edges</span>(core)
edges_io &lt;-<span class="st"> </span>edges_io <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(nodes_io, <span class="op">-</span>size), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;from&quot;</span> =<span class="st"> &quot;institute_place&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">x1 =</span> x, <span class="dt">y1 =</span> y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(nodes_io, <span class="op">-</span>size), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;to&quot;</span> =<span class="st"> &quot;institute_place&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">x2 =</span> x, <span class="dt">y2 =</span> y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(from, to) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">x1 =</span> <span class="kw">head</span>(x1, <span class="dv">1</span>), <span class="dt">y1 =</span> <span class="kw">head</span>(y1, <span class="dv">1</span>),
    <span class="dt">x2 =</span> <span class="kw">head</span>(x2, <span class="dv">1</span>), <span class="dt">y2 =</span> <span class="kw">head</span>(y2, <span class="dv">1</span>),
    <span class="dt">strength =</span> <span class="kw">n</span>())

nodes_io &lt;-<span class="st"> </span>nodes_io <span class="op">%&gt;%</span>
<span class="co">#   anti_join(nodes_eu, by = &quot;institute_place&quot;) %&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(nodes_ch, <span class="dt">by =</span> <span class="st">&quot;institute_place&quot;</span>)
edges_io &lt;-<span class="st"> </span>edges_io <span class="op">%&gt;%</span>
<span class="co">#   anti_join(edges_eu, by = c(&quot;from&quot; = &quot;from&quot;, &quot;to&quot; = &quot;to&quot;)) %&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(edges_ch, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;from&quot;</span> =<span class="st"> &quot;from&quot;</span>, <span class="st">&quot;to&quot;</span> =<span class="st"> &quot;to&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">drop_na</span>()

<span class="kw">svg</span>(<span class="st">&quot;map_int.svg&quot;</span>, <span class="dt">width =</span> <span class="dv">12</span>, <span class="dt">height =</span> <span class="dv">7</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))
maps<span class="op">::</span><span class="kw">map</span>(<span class="st">&quot;world&quot;</span>, <span class="dt">fill =</span> <span class="ot">FALSE</span>, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, .<span class="dv">2</span>))
<span class="co"># map nodes</span>
edge_col &lt;-<span class="st"> </span><span class="kw">make_ramp</span>(<span class="fl">0.5</span>, <span class="fl">0.2</span>)
<span class="kw">add_nodes</span>(nodes_io, <span class="dt">ramp =</span> edge_col, <span class="dt">cex_scale =</span> .<span class="dv">5</span>)
<span class="kw">add_edges</span>(edges_io, <span class="dt">ramp =</span> edge_col, <span class="dt">lwd_scale =</span> .<span class="dv">25</span>)
<span class="kw">invisible</span>(<span class="kw">dev.off</span>())</code></pre></div>
<p><a href="https://github.com/zambujo/swissresearch/">Source</a>. Last updated: 2018-01-22.</p>
</div>
</div>


    </div>
    <div class="col-md-2">
      <div id="toc">
      	<button type="button" class="close">Ã</button>
        <ul>
        <li><a href="#data">Data</a></li>
        <li><a href="#collaborations-within-switzerland">Collaborations within Switzerland</a></li>
        <li><a href="#collaborations-within-europe">Collaborations within Europe</a></li>
        <li><a href="#collaborations-with-the-rest-of-the-world">Collaborations with the rest of the world</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
$(document).ready(function () {

  // add bootstrap table styles to pandoc tables
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');

});
</script>

<script>
$(document).ready(function () {
 	 	$('#content img')
 	  .addClass("image-thumb");
      $('#content img')
 	  .addClass("image-lb");
  $('#content').magnificPopup({
	      type:'image',
	      closeOnContentClick: false,
	      delegate: 'img',
	      gallery: {enabled: true },
	      image: {
	        verticalFit: true,
          titleSrc: 'alt'
	      }
 	    });
 	});
</script>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
